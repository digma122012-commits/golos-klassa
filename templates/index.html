{% extends "base.html" %}
{% block content %}
<div class="container">
    <h1>üó£Ô∏è –ì–æ–ª–æ—Å –∫–ª–∞—Å—Å–∞</h1>
    <p style="font-size:14px; color:#e74c3c;">‚ö†Ô∏è –§–∞–π–ª—ã –º–æ–≥—É—Ç —É–¥–∞–ª—è—Ç—å—Å—è –ø—Ä–∏ –ø—Ä–æ—Å—Ç–æ–µ —Å–∞–π—Ç–∞. –ù–µ –∑–∞–≥—Ä—É–∂–∞–π—Ç–µ –≤–∞–∂–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã!</p>
    
    <form method="GET">
        <input type="text" name="q" value="{{ query }}" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–¥–µ—è–º –∏ —Ç–µ–º–∞–º..." 
               style="width:100%; padding:12px; border:1px solid #ddd; border-radius:8px; font-size:16px;">
        <button type="submit" style="margin-top:10px; width:100%; padding:12px; background:#3498db; color:white; border:none; border-radius:8px; cursor:pointer;">
            üîç –ù–∞–π—Ç–∏
        </button>
        {% if query %}
        <div style="margin-top:10px;"><a href="/" style="color:#3498db; text-decoration:underline;">–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –∏–¥–µ–∏</a></div>
        {% endif %}
    </form>
    
    <form method="POST" action="/add" enctype="multipart/form-data">
        <select name="theme" required onchange="toggleCustomTheme()">
            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ–º—É</option>
            {% for t in themes %}
            <option value="{{ t }}">{{ t }}</option>
            {% endfor %}
        </select>
        <input type="text" name="custom_theme" id="customTheme" placeholder="–í–∞—à–∞ —Ç–µ–º–∞..." style="display:none;">
        
        <textarea name="text" placeholder="–í–∞—à–∞ –∏–¥–µ—è (–¥–æ 200 —Å–∏–º–≤–æ–ª–æ–≤)..." maxlength="200" required></textarea>
        
        <input type="file" name="image" accept="image/*" style="display:none;" id="imageInput">
        <input type="file" name="video" accept="video/mp4,video/webm" style="display:none;" id="videoInput">
        <input type="file" name="file" accept="*/*" style="display:none;" id="fileInput">
        
        <div style="display:flex; flex-wrap:wrap; gap:8px; margin:12px 0;">
            <button type="button" onclick="document.getElementById('imageInput').click()">üì∑ –§–æ—Ç–æ</button>
            <button type="button" onclick="document.getElementById('videoInput').click()">üé• –í–∏–¥–µ–æ</button>
            <button type="button" onclick="document.getElementById('fileInput').click()">üìé –õ—é–±–æ–π —Ñ–∞–π–ª</button>
        </div>
        
        <button type="submit">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∏–¥–µ—é</button>
    </form>
    <hr>
    <h2>–ò–¥–µ–∏ {% if query %}–ø–æ –∑–∞–ø—Ä–æ—Å—É: {{ query }}{% endif %}</h2>
    {% if ideas %}
        {% for idea in ideas %}
        <div class="idea-card">
            <div class="theme-badge">{{ idea.custom_theme if idea.theme == '–î—Ä—É–≥–æ–µ' and idea.custom_theme else idea.theme }}</div>
            {% if idea.file_mime and idea.file_mime.startswith('image/') %}
                <img src="{{ url_for('preview_file', idea_id=idea.id) }}" class="media-preview">
            {% elif idea.file_mime and idea.file_mime.startswith('video/') %}
                <video controls playsinline class="media-preview" src="{{ url_for('preview_file', idea_id=idea.id) }}"></video>
            {% endif %}
            <h3>{{ idea.text[:100] }}{% if idea.text|length > 100 %}...{% endif %}</h3>
            <div class="meta">
                <span>–ì–æ–ª–æ—Å–æ–≤: {{ idea.votes }}</span>
                <a href="{{ url_for('vote', idea_id=idea.id) }}">‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å</a>
                <a href="{{ url_for('idea_detail', idea_id=idea.id) }}">–ü–æ–¥—Ä–æ–±–Ω–µ–µ ‚Üí</a>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <p>{% if query %}–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.{% else %}–ü–æ–∫–∞ –Ω–µ—Ç –∏–¥–µ–π.{% endif %}</p>
    {% endif %}
</div>
<script>
    function toggleCustomTheme() {
        const select = document.querySelector('select[name="theme"]');
        const custom = document.getElementById('customTheme');
        custom.style.display = select.value === '–î—Ä—É–≥–æ–µ' ? 'block' : 'none';
        if (select.value !== '–î—Ä—É–≥–æ–µ') custom.value = '';
    }
    document.getElementById('imageInput').addEventListener('change', function(e) {
        if (e.target.files.length > 0) {
            document.getElementById('videoInput').value = '';
            document.getElementById('fileInput').value = '';
        }
    });
    document.getElementById('videoInput').addEventListener('change', function(e) {
        if (e.target.files.length > 0) {
            document.getElementById('imageInput').value = '';
            document.getElementById('fileInput').value = '';
        }
    });
    document.getElementById('fileInput').addEventListener('change', function(e) {
        if (e.target.files.length > 0) {
            document.getElementById('imageInput').value = '';
            document.getElementById('videoInput').value = '';
        }
    });
</script>
{% endblock %}